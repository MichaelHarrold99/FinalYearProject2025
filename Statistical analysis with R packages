# analyze_tree.R
# Load required libraries
library(ape)
library(dplyr)
library(phangorn)
library(ggplot2)

# Read the phylogenetic tree generated by FastTree
tree <- read.tree("all_assemblies.tree")

# Root the tree at its midpoint
tree_rooted <- midpoint(tree)

# Calculate root-to-tip distances for each tip
tip_distances <- data.frame(
  sample = tree_rooted$tip.label,
  distance = distRoot(tree_rooted)
)

# Adding 'Hypermutator' or 'Non-Hypermutator' metadata.
metadata <- read.csv("metadata.csv", stringsAsFactors = FALSE)
data_combined <- merge(tip_distances, metadata, by = "sample")

# Plot branch length distribution by group
p <- ggplot(data_combined, aes(x = group, y = distance, fill = group)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Branch Length Comparison", x = "Group", y = "Root-to-Tip Distance")
print(p)

# Statistical tests: Welch Two Sample t-test
t_test_result <- t.test(distance ~ group, data = data_combined)
print(t_test_result)

# Wilcoxon rank sum test
wilcox_result <- wilcox.test(distance ~ group, data = data_combined)
print(wilcox_result)

# For comparing three groups (e.g., different hypermutator variants),
anova_result <- aov(distance ~ group, data = data_combined)
summary(anova_result)

# If ANOVA is significant, perform Tukey's HSD post-hoc test
tukey_result <- TukeyHSD(anova_result)
print(tukey_result)
